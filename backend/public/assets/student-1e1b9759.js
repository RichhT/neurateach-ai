import{r as n,u as D,a as U,j as e,L as te,b as j,c as J,A as se,B as re,R as ne,d as M,N as F,e as Z,f as ie,g as oe}from"./index-4bb66c81.js";function ae(){console.log("Student Welcome component rendering");const[o,c]=n.useState("login"),[a,b]=n.useState({email:"",password:"",name:"",confirmPassword:""}),[B,v]=n.useState(""),[S,m]=n.useState(!1),{login:I,register:l}=D(),y=U(),w=k=>{b({...a,[k.target.name]:k.target.value})},C=async k=>{if(k.preventDefault(),m(!0),v(""),o==="register"){if(a.password!==a.confirmPassword){v("Passwords do not match"),m(!1);return}const s=await l(a.name,a.email,a.password,"student");s.success?y("/dashboard"):v(s.error)}else{const s=await I(a.email,a.password);s.success?y("/dashboard"):v(s.error)}m(!1)},t={container:{minHeight:"100vh",background:"linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)",color:"white"},header:{padding:"40px 0",textAlign:"center",position:"relative"},backHome:{position:"absolute",left:"20px",top:"50%",transform:"translateY(-50%)",color:"rgba(255,255,255,0.9)",textDecoration:"none",fontWeight:"500"},title:{fontSize:"3rem",fontWeight:"700",marginBottom:"10px",textShadow:"2px 2px 4px rgba(0,0,0,0.3)"},subtitle:{fontSize:"1.2rem",opacity:.9},content:{maxWidth:"1200px",margin:"0 auto",padding:"0 20px"},hero:{display:"grid",gridTemplateColumns:"1fr 400px",gap:"60px",alignItems:"center",minHeight:"70vh"},heroText:{fontSize:"2.5rem",marginBottom:"30px",fontWeight:"600"},featureList:{listStyle:"none",padding:0},featureItem:{fontSize:"1.2rem",marginBottom:"15px",padding:"10px 0",opacity:.95},authSection:{background:"rgba(255, 255, 255, 0.95)",borderRadius:"20px",padding:"40px",boxShadow:"0 20px 40px rgba(0,0,0,0.1)"},authTabs:{display:"flex",marginBottom:"30px",background:"#f8f9fa",borderRadius:"10px",padding:"5px"},tab:{flex:1,padding:"12px 20px",border:"none",background:"transparent",borderRadius:"8px",fontWeight:"600",color:"#6c757d",cursor:"pointer"},tabActive:{background:"linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)",color:"white",boxShadow:"0 2px 10px rgba(231, 76, 60, 0.3)"},authForm:{color:"#333"},formGroup:{marginBottom:"20px"},label:{display:"block",marginBottom:"8px",fontWeight:"600",color:"#495057"},input:{width:"100%",padding:"15px",border:"2px solid #e9ecef",borderRadius:"10px",fontSize:"16px"},authButton:{width:"100%",padding:"15px",fontSize:"16px",fontWeight:"600",borderRadius:"10px",border:"none",background:"linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)",color:"white",cursor:"pointer",boxShadow:"0 5px 15px rgba(231, 76, 60, 0.4)"},error:{background:"#f8d7da",color:"#721c24",padding:"12px",borderRadius:"8px",marginBottom:"20px",border:"1px solid #f5c6cb"}};return e.jsxs("div",{style:t.container,children:[e.jsxs("div",{style:t.header,children:[e.jsx(te,{to:"/",style:t.backHome,children:"← Back to Home"}),e.jsx("h1",{style:t.title,children:"Student Portal"}),e.jsx("p",{style:t.subtitle,children:"Accelerate your learning with AI-powered study tools"})]}),e.jsx("div",{style:t.content,children:e.jsxs("div",{style:t.hero,children:[e.jsxs("div",{children:[e.jsx("h2",{style:t.heroText,children:"Unlock Your Potential"}),e.jsxs("ul",{style:t.featureList,children:[e.jsx("li",{style:t.featureItem,children:"📖 Access personalized learning materials"}),e.jsx("li",{style:t.featureItem,children:"🧠 Take adaptive AI-powered assessments"}),e.jsx("li",{style:t.featureItem,children:"📊 Track your learning progress"}),e.jsx("li",{style:t.featureItem,children:"🎯 Focus on areas that need improvement"}),e.jsx("li",{style:t.featureItem,children:"🏆 Achieve your academic goals faster"})]})]}),e.jsxs("div",{style:t.authSection,children:[e.jsxs("div",{style:t.authTabs,children:[e.jsx("button",{style:{...t.tab,...o==="login"?t.tabActive:{}},onClick:()=>c("login"),children:"Login"}),e.jsx("button",{style:{...t.tab,...o==="register"?t.tabActive:{}},onClick:()=>c("register"),children:"Register"})]}),e.jsxs("div",{style:t.authForm,children:[B&&e.jsx("div",{style:t.error,children:B}),e.jsxs("form",{onSubmit:C,children:[o==="register"&&e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{htmlFor:"name",style:t.label,children:"Full Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:a.name,onChange:w,required:!0,placeholder:"Enter your full name",style:t.input})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{htmlFor:"email",style:t.label,children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:a.email,onChange:w,required:!0,placeholder:"Enter your email",style:t.input})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{htmlFor:"password",style:t.label,children:"Password"}),e.jsx("input",{type:"password",id:"password",name:"password",value:a.password,onChange:w,required:!0,placeholder:"Enter your password",style:t.input})]}),o==="register"&&e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{htmlFor:"confirmPassword",style:t.label,children:"Confirm Password"}),e.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:a.confirmPassword,onChange:w,required:!0,placeholder:"Confirm your password",style:t.input})]}),e.jsx("button",{type:"submit",style:t.authButton,disabled:S,children:S?o==="login"?"Logging in...":"Creating account...":o==="login"?"Access Learning Portal":"Create Student Account"})]})]})]})]})})]})}function le(){const{user:o,logout:c}=D(),a=U(),[b,B]=n.useState([]),[v,S]=n.useState([]),[m,I]=n.useState(!0),[l,y]=n.useState("my-courses");n.useEffect(()=>{w()},[]);const w=async()=>{var s;try{const[_,R]=await Promise.all([j.get("/api/enrollments/my-enrollments"),j.get("/api/enrollments/available-units")]);B(_.data),S(R.data)}catch(_){console.error("Failed to fetch data:",_),console.error("Error details:",((s=_.response)==null?void 0:s.data)||_.message)}finally{I(!1)}},C=async s=>{try{await j.post("/api/enrollments",{unitId:s}),w()}catch(_){console.error("Failed to enroll:",_),alert("Failed to enroll in unit")}},t=s=>s>=8?"#gold":s>=5?"#silver":"#bronze",k=s=>s>=80?"#28a745":s>=60?"#ffc107":"#dc3545";return m?e.jsx("div",{style:{textAlign:"center",marginTop:"3rem"},children:e.jsx("div",{children:"Loading your learning dashboard..."})}):(console.log("Student Dashboard rendering"),console.log("Enrollments:",b.length),console.log("Available units:",v.length),e.jsx("div",{style:{maxWidth:"1200px",margin:"2rem auto",padding:"0 1rem"},children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[e.jsxs("div",{children:[e.jsxs("h1",{children:["Welcome back, ",o==null?void 0:o.name,"! 🎓"]}),e.jsx("p",{style:{color:"#666",margin:0},children:"Ready to continue your learning journey?"})]}),e.jsx("button",{onClick:c,className:"btn btn-secondary",children:"Logout"})]}),e.jsx("div",{style:{borderBottom:"1px solid #dee2e6",marginBottom:"2rem"},children:e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsxs("button",{onClick:()=>y("my-courses"),style:{padding:"0.5rem 1rem",border:"none",background:"none",borderBottom:l==="my-courses"?"2px solid #007bff":"2px solid transparent",color:l==="my-courses"?"#007bff":"#666",cursor:"pointer"},children:["My Courses (",b.length,")"]}),e.jsx("button",{onClick:()=>y("browse"),style:{padding:"0.5rem 1rem",border:"none",background:"none",borderBottom:l==="browse"?"2px solid #007bff":"2px solid transparent",color:l==="browse"?"#007bff":"#666",cursor:"pointer"},children:"Browse Courses"})]})}),l==="my-courses"&&e.jsx("div",{children:b.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"3rem 1rem"},children:[e.jsx("h3",{children:"No courses enrolled yet"}),e.jsx("p",{style:{color:"#666",marginBottom:"2rem"},children:"Start your learning journey by enrolling in a course!"}),e.jsx("button",{onClick:()=>y("browse"),className:"btn btn-primary",children:"Browse Available Courses"})]}):e.jsx("div",{style:{display:"grid",gap:"1.5rem",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))"},children:b.map(s=>e.jsx("div",{className:"card",style:{border:"1px solid #dee2e6"},children:e.jsxs("div",{style:{padding:"1.5rem"},children:[e.jsx("h3",{style:{marginBottom:"0.5rem"},children:s.unit_name}),e.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1rem"},children:["by ",s.teacher_name]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:t(s.current_level)},children:["🔥 Level ",s.current_level]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"#666"},children:[s.total_xp||0," XP"]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:k(s.avg_mastery)},children:["🧠 ",s.avg_mastery,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:"Mastery"})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8rem",marginBottom:"0.25rem"},children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[s.total_objectives," objectives"]})]}),e.jsx("div",{style:{height:"8px",backgroundColor:"#e9ecef",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",backgroundColor:"#28a745",width:`${s.completion_percentage||0}%`,transition:"width 0.3s ease"}})})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"btn btn-primary",style:{flex:1},onClick:()=>a(`/course/${s.enrollment_id}/study`),children:"📚 Study"}),e.jsx("button",{className:"btn btn-outline-primary",style:{flex:1},onClick:()=>a(`/course/${s.enrollment_id}/quiz`),children:"🎯 Quiz"})]})]})},s.enrollment_id))})}),l==="browse"&&e.jsxs("div",{children:[e.jsx("h3",{children:"Available Courses"}),v.filter(s=>!s.is_enrolled).length===0?e.jsx("div",{style:{textAlign:"center",padding:"3rem 1rem"},children:e.jsx("p",{style:{color:"#666"},children:"No new courses available. You're enrolled in all available courses!"})}):e.jsx("div",{style:{display:"grid",gap:"1.5rem",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))"},children:v.filter(s=>!s.is_enrolled).map(s=>e.jsx("div",{className:"card",style:{border:"1px solid #dee2e6"},children:e.jsxs("div",{style:{padding:"1.5rem"},children:[e.jsx("h4",{style:{marginBottom:"0.5rem"},children:s.name}),e.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1rem"},children:["by ",s.teacher_name]}),e.jsx("p",{style:{fontSize:"0.9rem",marginBottom:"1rem",color:"#333"},children:s.description||"No description available"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem",fontSize:"0.8rem",color:"#666"},children:[e.jsxs("span",{children:["📝 ",s.objectives_count," objectives"]}),e.jsxs("span",{children:["📅 ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsx("button",{onClick:()=>C(s.id),className:"btn btn-success",style:{width:"100%"},children:"Enroll Now"})]})},s.id))})]})]})}))}function V(){const{enrollmentId:o,objectiveId:c}=J(),{user:a}=D(),b=U(),[B,v]=n.useState(!0),[S,m]=n.useState(null),[I,l]=n.useState([]),[y,w]=n.useState(""),[C,t]=n.useState(!1),[k,s]=n.useState({duration:0,xpEarned:0,shouldSuggestQuiz:!1}),[_,R]=n.useState([]),[f,L]=n.useState(null),P=n.useRef(null),z=n.useRef(Date.now());n.useEffect(()=>{G()},[o,c]),n.useEffect(()=>{Y()},[I]),n.useEffect(()=>{const i=setInterval(()=>{const u=Math.floor((Date.now()-z.current)/6e4);s(h=>({...h,duration:u}))},6e4);return()=>clearInterval(i)},[]);const Y=()=>{var i;(i=P.current)==null||i.scrollIntoView({behavior:"smooth"})},G=async()=>{var i,u,h;try{console.log("Initializing study session for enrollment:",o,"objective:",c);const g=await j.get(`/api/enrollments/${o}/progress`);console.log("Progress data:",g.data),R(g.data);const N=g.data.find(W=>W.objective_id==c)||g.data[0];console.log("Target objective:",N),L(N);const E=await j.get(`/api/teaching/active-session/${o}`);if(E.data.activeSession)m(E.data.activeSession),l(E.data.recentMessages),z.current=new Date(E.data.activeSession.started_at).getTime();else{const W=await j.post("/api/teaching/start-session",{enrollmentId:parseInt(o),objectiveId:N.objective_id});m(W.data);const H={speaker:"agent",message_content:`Hello ${a.name}! 👋 Let's work on: "${N.objective_text}". What would you like to learn about this topic?`,teaching_technique:"welcome",timestamp:new Date().toISOString()};l([H]),await j.post("/api/teaching/add-message",{sessionId:W.data.sessionId,speaker:"agent",message:H.message_content,teachingTechnique:"welcome"})}}catch(g){console.error("Failed to initialize study session:",g),console.error("Error details:",((i=g.response)==null?void 0:i.data)||g.message),alert("Failed to start study session: "+(((h=(u=g.response)==null?void 0:u.data)==null?void 0:h.error)||g.message)),b("/dashboard")}finally{v(!1)}},$=async()=>{if(!y.trim()||C)return;const i={speaker:"student",message_content:y,timestamp:new Date().toISOString()};l(u=>[...u,i]),w(""),t(!0);try{await j.post("/api/teaching/add-message",{sessionId:S.sessionId,speaker:"student",message:y,teachingTechnique:null});const u=await j.post("/api/teaching/get-ai-response",{sessionId:S.sessionId,studentMessage:y,objectiveText:f.objective_text,conversationHistory:I}),h={speaker:"agent",message_content:u.data.aiResponse,teaching_technique:u.data.teachingTechnique,timestamp:new Date().toISOString()};l(g=>[...g,h]),await j.post("/api/teaching/add-message",{sessionId:S.sessionId,speaker:"agent",message:u.data.aiResponse,teachingTechnique:u.data.teachingTechnique})}catch(u){console.error("Failed to send message:",u);const h={speaker:"agent",message_content:"Sorry, I encountered an error. Please try again.",teaching_technique:"error",timestamp:new Date().toISOString()};l(g=>[...g,h])}finally{t(!1)}},T=async()=>{try{const i=Math.floor((Date.now()-z.current)/6e4),u=I.length>6?.8:.6,h=await j.post("/api/teaching/end-session",{sessionId:S.sessionId,sessionQuality:u,topicsCovered:[f.objective_text],comprehensionIndicators:{messageCount:I.length}});if(s({duration:i,xpEarned:h.data.xpEarned,shouldSuggestQuiz:h.data.shouldSuggestQuiz,levelUp:h.data.levelUp,newLevel:h.data.newLevel}),h.data.shouldSuggestQuiz){const g=window.confirm(`Great study session! You earned ${h.data.xpEarned} XP${h.data.levelUp?` and reached Level ${h.data.newLevel}!`:""}. Would you like to test your knowledge with a quiz?`);b(g?`/course/${o}/quiz/${f.objective_id}`:"/dashboard")}else alert(`Session completed! You earned ${h.data.xpEarned} XP.`),b("/dashboard")}catch(i){console.error("Failed to end session:",i),b("/dashboard")}},O=async i=>{S&&await T(),b(`/course/${o}/study/${i}`)};return B?e.jsx("div",{style:{textAlign:"center",marginTop:"3rem"},children:e.jsx("div",{children:"Starting your study session..."})}):e.jsxs("div",{style:{maxWidth:"1000px",margin:"2rem auto",padding:"0 1rem"},children:[e.jsx("div",{className:"card",style:{marginBottom:"1rem"},children:e.jsx("div",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h2",{children:"📚 Study Mode"}),e.jsxs("p",{style:{margin:0,color:"#666"},children:["Learning: ",f==null?void 0:f.objective_text]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{fontSize:"1.2rem",color:"#007bff"},children:["⏱️ ",k.duration," min | 🔥 +",k.xpEarned," XP"]}),e.jsx("button",{onClick:T,className:"btn btn-outline-secondary",style:{marginTop:"0.5rem"},children:"End Session"})]})]})})}),e.jsxs("div",{style:{display:"flex",gap:"1rem",height:"600px"},children:[e.jsxs("div",{className:"card",style:{width:"250px",display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{padding:"1rem",borderBottom:"1px solid #dee2e6"},children:e.jsx("h4",{children:"Learning Objectives"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0.5rem"},children:_.map((i,u)=>e.jsxs("div",{onClick:()=>O(i.objective_id),style:{padding:"0.75rem",margin:"0.25rem 0",borderRadius:"4px",cursor:"pointer",backgroundColor:i.objective_id===(f==null?void 0:f.objective_id)?"#e3f2fd":"white",border:i.objective_id===(f==null?void 0:f.objective_id)?"1px solid #2196f3":"1px solid #dee2e6",transition:"all 0.2s ease"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.25rem"},children:["Objective ",u+1]}),e.jsx("div",{style:{fontSize:"0.9rem",lineHeight:"1.3"},children:i.objective_text}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"0.5rem",fontSize:"0.7rem"},children:[e.jsxs("span",{style:{color:"#007bff"},children:["🔥 Level ",i.current_level]}),e.jsxs("span",{style:{color:"#28a745"},children:["🧠 ",i.mastery_percentage,"%"]})]})]},i.objective_id))})]}),e.jsxs("div",{className:"card",style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{padding:"1rem",borderBottom:"1px solid #dee2e6",backgroundColor:"#f8f9fa"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"🤖"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:"AI Tutor"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:"Ready to help you learn!"})]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"1rem",display:"flex",flexDirection:"column",gap:"1rem"},children:[I.map((i,u)=>e.jsx("div",{style:{display:"flex",justifyContent:i.speaker==="student"?"flex-end":"flex-start"},children:e.jsx("div",{style:{maxWidth:"70%",padding:"0.75rem 1rem",borderRadius:"18px",backgroundColor:i.speaker==="student"?"#007bff":"#f1f3f4",color:i.speaker==="student"?"white":"#333",fontSize:"0.95rem",lineHeight:"1.4"},children:i.message_content})},u)),C&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-start"},children:e.jsx("div",{style:{padding:"0.75rem 1rem",borderRadius:"18px",backgroundColor:"#f1f3f4",color:"#666"},children:"AI Tutor is typing..."})}),e.jsx("div",{ref:P})]}),e.jsx("div",{style:{padding:"1rem",borderTop:"1px solid #dee2e6"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:y,onChange:i=>w(i.target.value),onKeyPress:i=>i.key==="Enter"&&$(),placeholder:"Ask a question or share your thoughts...",style:{flex:1,padding:"0.75rem",border:"1px solid #dee2e6",borderRadius:"20px",outline:"none",fontSize:"0.95rem"},disabled:C}),e.jsx("button",{onClick:$,disabled:!y.trim()||C,style:{padding:"0.75rem 1.5rem",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"20px",cursor:"pointer",fontSize:"0.95rem",opacity:!y.trim()||C?.5:1},children:"Send"})]})})]})]})]})}function K(){const{enrollmentId:o,objectiveId:c}=J();D();const a=U(),[b,B]=n.useState(!0),[v,S]=n.useState(null),[m,I]=n.useState([]),[l,y]=n.useState(0),[w,C]=n.useState({}),[t,k]=n.useState(""),[s,_]=n.useState(3),[R,f]=n.useState(0),[L,P]=n.useState(!1),[z,Y]=n.useState(null),[G,$]=n.useState([]),[T,O]=n.useState(null),[i,u]=n.useState(!1);n.useEffect(()=>{h()},[o,c]),n.useEffect(()=>{if(R>0&&!L){const r=setTimeout(()=>{f(R-1)},1e3);return()=>clearTimeout(r)}else R===0&&v&&!L&&N()},[R,L,v]);const h=async()=>{var r,p,x;try{console.log("Initializing quiz for enrollment:",o,"objective:",c);const d=await j.get(`/api/enrollments/${o}/progress`);if(console.log("Progress data:",d.data),$(d.data),c){const q=d.data.find(ee=>ee.objective_id==c);if(q)console.log("Target objective:",q),O(q);else{console.error("Objective not found:",c),alert("Objective not found"),a("/dashboard");return}}else{console.log("No objective specified, showing selection screen"),u(!0),B(!1);return}const A=await j.post("/api/assessment/start-quiz",{enrollmentId:parseInt(o),objectiveId:T.objective_id,questionCount:5});S(A.data),I(A.data.questions),f(A.data.timeLimit*60)}catch(d){console.error("Failed to initialize quiz:",d),console.error("Error details:",((r=d.response)==null?void 0:r.data)||d.message),alert("Failed to start quiz: "+(((x=(p=d.response)==null?void 0:p.data)==null?void 0:x.error)||d.message)),a("/dashboard")}finally{B(!1)}},g=async()=>{var d;if(!t){alert("Please select an answer");return}const r=m[l],p=((d=w[r.id])==null?void 0:d.startTime)||Date.now(),x=Math.round((Date.now()-p)/1e3);try{const A=await j.post("/api/assessment/submit-answer",{quizSessionId:v.quizSessionId,questionId:r.id,answer:t,timeTaken:x,confidenceLevel:s});C(q=>({...q,[r.id]:{answer:t,confidence:s,timeTaken:x,isCorrect:A.data.isCorrect,correctAnswer:A.data.correctAnswer,explanation:A.data.explanation,startTime:p}})),l<m.length-1?(y(l+1),k(""),_(3),C(q=>({...q,[m[l+1].id]:{...q[m[l+1].id],startTime:Date.now()}}))):N()}catch(A){console.error("Failed to submit answer:",A),alert("Failed to submit answer")}},N=async()=>{try{const r=await j.post("/api/assessment/complete-quiz",{quizSessionId:v.quizSessionId});Y(r.data.quizResults),P(!0)}catch(r){console.error("Failed to complete quiz:",r),alert("Failed to complete quiz")}},E=async r=>{var p,x;try{B(!0),O(r),u(!1);const d=await j.post("/api/assessment/start-quiz",{enrollmentId:parseInt(o),objectiveId:r.objective_id,questionCount:5});S(d.data),I(d.data.questions),f(d.data.timeLimit*60)}catch(d){console.error("Failed to start quiz:",d),alert("Failed to start quiz: "+(((x=(p=d.response)==null?void 0:p.data)==null?void 0:x.error)||d.message)),a("/dashboard")}finally{B(!1)}},W=r=>{const p=Math.floor(r/60),x=r%60;return`${p}:${x.toString().padStart(2,"0")}`},H=r=>["Very Uncertain","Uncertain","Somewhat Sure","Sure","Very Sure"][r-1];if(n.useEffect(()=>{m.length>0&&!w[m[0].id]&&C(r=>({...r,[m[0].id]:{startTime:Date.now()}}))},[m]),b)return e.jsx("div",{style:{textAlign:"center",marginTop:"3rem"},children:e.jsx("div",{children:"Preparing your quiz..."})});if(i)return e.jsx("div",{style:{maxWidth:"800px",margin:"2rem auto",padding:"0 1rem"},children:e.jsx("div",{className:"card",children:e.jsxs("div",{style:{padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("h2",{children:"🎯 Choose Learning Objective"}),e.jsx("p",{style:{color:"#666",margin:0},children:"Select which objective you'd like to quiz on:"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:G.map((r,p)=>{const x=r.mastery_score>=.8?"#28a745":r.mastery_score>=.6?"#ffc107":"#dc3545";return e.jsx("div",{onClick:()=>E(r),className:"card",style:{padding:"1.5rem",cursor:"pointer",border:"2px solid #dee2e6",transition:"all 0.2s ease",":hover":{borderColor:"#007bff"}},onMouseEnter:d=>d.target.style.borderColor="#007bff",onMouseLeave:d=>d.target.style.borderColor="#dee2e6",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:["Objective ",p+1]}),e.jsx("div",{style:{color:"#333",marginBottom:"0.5rem"},children:r.objective_text}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#666"},children:["Quiz attempts: ",r.quiz_attempts_count||0]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:x,marginBottom:"0.25rem"},children:[Math.round((r.mastery_score||0)*100),"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:"Mastery"})]})]})},r.objective_id)})}),e.jsx("div",{style:{textAlign:"center",marginTop:"2rem"},children:e.jsx("button",{onClick:()=>a("/dashboard"),className:"btn btn-secondary",children:"Back to Dashboard"})})]})})});if(L&&z)return e.jsx("div",{style:{maxWidth:"800px",margin:"2rem auto",padding:"0 1rem"},children:e.jsx("div",{className:"card",children:e.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[e.jsx("h2",{children:"🎯 Quiz Complete!"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"1rem",margin:"2rem 0"},children:[e.jsxs("div",{className:"card",style:{padding:"1rem",backgroundColor:"#f8f9fa"},children:[e.jsxs("div",{style:{fontSize:"2rem",color:"#007bff"},children:[z.scorePercentage,"%"]}),e.jsx("div",{style:{fontSize:"0.9rem",color:"#666"},children:"Score"})]}),e.jsxs("div",{className:"card",style:{padding:"1rem",backgroundColor:"#f8f9fa"},children:[e.jsxs("div",{style:{fontSize:"2rem",color:"#28a745"},children:[z.correctAnswers,"/",z.totalQuestions]}),e.jsx("div",{style:{fontSize:"0.9rem",color:"#666"},children:"Correct"})]}),e.jsxs("div",{className:"card",style:{padding:"1rem",backgroundColor:"#f8f9fa"},children:[e.jsxs("div",{style:{fontSize:"2rem",color:z.masteryChange>0?"#28a745":"#dc3545"},children:[z.newMastery,"%"]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#666"},children:["Mastery ",z.masteryChange>0?"↗":z.masteryChange<0?"↘":"→"]})]})]}),e.jsx("div",{style:{padding:"1rem",backgroundColor:"#e3f2fd",borderRadius:"8px",marginBottom:"2rem"},children:e.jsx("p",{style:{margin:0,fontSize:"1.1rem"},children:z.improvementMessage})}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"2rem"},children:[e.jsx("h3",{children:"Question Review"}),m.map((r,p)=>{const x=w[r.id];return e.jsxs("div",{className:"card",style:{margin:"1rem 0",padding:"1rem",borderLeft:`4px solid ${x.isCorrect?"#28a745":"#dc3545"}`},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:["Question ",p+1,": ",x.isCorrect?"✅":"❌"]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:r.question_text}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#666"},children:["Your answer: ",e.jsx("strong",{children:x.answer})," | Correct answer: ",e.jsx("strong",{children:x.correctAnswer})]}),x.explanation&&e.jsxs("div",{style:{marginTop:"0.5rem",padding:"0.5rem",backgroundColor:"#f8f9fa",borderRadius:"4px",fontSize:"0.9rem"},children:["💡 ",x.explanation]})]},r.id)})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>a("/dashboard"),className:"btn btn-primary",children:"Back to Dashboard"}),e.jsx("button",{onClick:()=>a(`/course/${o}/study/${T.objective_id}`),className:"btn btn-outline-primary",children:"Study More"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-outline-secondary",children:"Retake Quiz"})]})]})})});const X=m[l];return e.jsxs("div",{style:{maxWidth:"800px",margin:"2rem auto",padding:"0 1rem"},children:[e.jsx("div",{className:"card",style:{marginBottom:"1rem"},children:e.jsx("div",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h2",{children:"🎯 Mastery Quiz"}),e.jsx("p",{style:{margin:0,color:"#666"},children:T==null?void 0:T.objective_text})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{fontSize:"1.2rem",color:R<60?"#dc3545":"#007bff",fontWeight:"bold"},children:["⏱️ ",W(R)]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#666"},children:["Question ",l+1," of ",m.length]})]})]})})}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsx("div",{style:{height:"8px",backgroundColor:"#e9ecef",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",backgroundColor:"#007bff",width:`${(l+1)/m.length*100}%`,transition:"width 0.3s ease"}})})}),X&&e.jsx("div",{className:"card",children:e.jsxs("div",{style:{padding:"2rem"},children:[e.jsx("h3",{style:{marginBottom:"1.5rem"},children:X.question_text}),e.jsx("div",{style:{marginBottom:"2rem"},children:Object.entries(X.options).map(([r,p])=>e.jsx("div",{onClick:()=>k(r),style:{padding:"1rem",margin:"0.5rem 0",border:`2px solid ${t===r?"#007bff":"#dee2e6"}`,borderRadius:"8px",cursor:"pointer",backgroundColor:t===r?"#e3f2fd":"white",transition:"all 0.2s ease"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",backgroundColor:t===r?"#007bff":"white",border:`2px solid ${t===r?"#007bff":"#dee2e6"}`,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.8rem",fontWeight:"bold"},children:t===r&&"✓"}),e.jsxs("span",{style:{fontWeight:"bold",marginRight:"0.5rem"},children:[r,")"]}),e.jsx("span",{children:p})]})},r))}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold"},children:"How confident are you in your answer?"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("input",{type:"range",min:"1",max:"5",value:s,onChange:r=>_(parseInt(r.target.value)),style:{flex:1}}),e.jsx("span",{style:{minWidth:"120px",fontSize:"0.9rem",color:"#666"},children:H(s)})]})]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("button",{onClick:g,disabled:!t,className:"btn btn-primary",style:{padding:"0.75rem 2rem",fontSize:"1.1rem",opacity:t?1:.5},children:l<m.length-1?"Next Question":"Complete Quiz"})})]})})]})}function Q({children:o}){const{user:c,loading:a}=D();return a?e.jsx("div",{className:"loading",style:{padding:"50px",textAlign:"center"},children:"Loading..."}):c?c.userType!=="student"?(window.location.href="/teacher",null):o:e.jsx(Z,{to:"/"})}function de({children:o}){const{user:c,loading:a}=D();return a?e.jsx("div",{className:"loading",style:{padding:"50px",textAlign:"center"},children:"Loading..."}):c&&c.userType==="student"?e.jsx(Z,{to:"/dashboard"}):c&&c.userType!=="student"?(window.location.href="/teacher",null):o}function ce(){return e.jsx(se,{children:e.jsx(re,{children:e.jsx("div",{className:"App",children:e.jsxs(ne,{children:[e.jsx(M,{path:"/",element:e.jsx(de,{children:e.jsx(ae,{})})}),e.jsx(M,{path:"/dashboard",element:e.jsx(Q,{children:e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx("main",{className:"container",children:e.jsx(le,{})})]})})}),e.jsx(M,{path:"/course/:enrollmentId/study",element:e.jsx(Q,{children:e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx("main",{className:"container",children:e.jsx(V,{})})]})})}),e.jsx(M,{path:"/course/:enrollmentId/study/:objectiveId",element:e.jsx(Q,{children:e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx("main",{className:"container",children:e.jsx(V,{})})]})})}),e.jsx(M,{path:"/course/:enrollmentId/quiz",element:e.jsx(Q,{children:e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx("main",{className:"container",children:e.jsx(K,{})})]})})}),e.jsx(M,{path:"/course/:enrollmentId/quiz/:objectiveId",element:e.jsx(Q,{children:e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx("main",{className:"container",children:e.jsx(K,{})})]})})})]})})})})}ie.createRoot(document.getElementById("root")).render(e.jsx(oe.StrictMode,{children:e.jsx(ce,{})}));
